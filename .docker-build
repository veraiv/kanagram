# ===========================================
FROM openapitools/openapi-generator-cli:latest AS openapi-generator

WORKDIR /app

COPY ./openapi/api.yaml /openapi/api.yaml
COPY ./openapi/config.json /openapi/config.json
RUN  /usr/local/bin/docker-entrypoint.sh generate -i /openapi/api.yaml -g kotlin-spring --config /openapi/config.json --output /app  

# ===========================================
FROM maven:3.9.9-eclipse-temurin-11 AS builder

USER root

COPY --from=openapi-generator /app /app/app
 
WORKDIR /app/app

RUN mvn clean package

ENTRYPOINT [ "java" , "-jar", "/app/app/target/openapi-spring-1.0.0.jar"]

# ===========================================
FROM eclipse-temurin:21-alpine 

WORKDIR /app

COPY --from=builder /app/app/target/*.jar app.jar

EXPOSE 8080

ENTRYPOINT ["java", "-jar", "app.jar"]
